/*
 * ws2812b.c
 */
#define __WS2812B_C_735f31908ba311eaab120800200c9a66	1

#include "ws2812b.h"

#include <stdint.h>

#include <avr/pgmspace.h>

/* 2D structure: Every coloumn corresponds to a databyte to be translate into NRZO-SPI bits */
/*               The lines are the 24 spi-bits per databyte to be transmitted               */
/* In order to save cycles, we avoid loading registers whereever we can - so align properly */

/*
 * // compile with "gcc gen.c -o gen"
 * #include <stdlib.h>
 * #include <stdio.h>
 * 
 * #include <stdint.h>
 * 
 * static uint8_t __NRZIsequence[3][256];
 * 
 * int main(int argc, char **argv) {
 * int x,y;
 * 
 * //fill the array
 * for (x=0;x<256;x++) {
 * uint8_t i, tmp;
 * uint32_t nrzibits = 0;
 * 
 * //x is the data value to translate into nrzo
 * tmp=x;
 * for (i=0;i<8;i++) {
 * nrzibits<<=3;
 * if ((tmp & 0x80) != 0)  nrzibits|=0b110; //1
 * else                    nrzibits|=0b100; //0
 * tmp<<=1;
 * }
 * 
 * for (y=0;y<3;y++) {
 * __NRZIsequence[y][x]=nrzibits & 0xff;
 * nrzibits>>=8;
 * }
 * }
 * 
 * //output the array as C structure
 * for (y=0;y<3;y++) {
 * printf("t{");
 * for (x=0;x<256;x++) {
 * printf("0x%02x, ",__NRZIsequence[y][x]);
 * }
 * printf("},n");
 * }
 * return EXIT_SUCCESS;
 * }
 */
static const PROGMEM __attribute__ ((used,aligned(256))) uint8_t __NRZIsequence[3][256] = {
	{0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, 0x24, 0x26, 0x34, 0x36, 0xa4, 0xa6, 0xb4, 0xb6, },
	{0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x49, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x4d, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x69, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, 0x6d, },
	{0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x92, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x93, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9a, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0x9b, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd2, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xd3, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xda, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, 0xdb, },
};

EXTFUNC_void(int8_t, ws2812b_initialize) {
  __register7=pgm_read_byte(&__NRZIsequence[__register2][__register3]);
  return 0;
}

EXTFUNC_void(int8_t, ws2812b_finalize) {
  return 0;
}

